<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Mise à jour — Bento Budget</title>
  <style>
    :root { color-scheme: dark; }
    body { margin:0; font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial;
           background:#0b1220; color:#e5e7eb; display:grid; place-items:center; height:100vh; }
    .card { width: 380px; border-radius:16px; padding:18px 20px; background:#0f172a; box-shadow: 0 8px 20px rgb(0 0 0 / 35%); }
    h1 { font-size:16px; margin:0 0 10px 0; color:#e2e8f0; }
    p { margin:6px 0; font-size:13px; color:#94a3b8; }
    .bar { width:100%; height:10px; background:#1f2937; border-radius:9999px; overflow:hidden; margin-top:10px;}
    .fill { height:100%; width:0%; background:linear-gradient(90deg,#6366f1,#22d3ee); transition: width .15s ease; }
    .row { display:flex; justify-content:space-between; margin-top:8px; font-size:12px; color:#cbd5e1;}
    .ok { margin-top:12px; display:none; font-size:13px; color:#a7f3d0; }
    .err { margin-top:12px; display:none; font-size:13px; color:#fecaca; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Mise à jour de Bento Budget</h1>
    <p id="state">Recherche de mise à jour…</p>
    <div class="bar"><div id="fill" class="fill"></div></div>
    <div class="row">
      <span id="percent">0%</span>
      <span id="speed">0 MB/s</span>
    </div>
    <p id="ok" class="ok">Téléchargement terminé. Installation…</p>
    <p id="err" class="err"></p>
  </div>

  <script>
    const state = document.getElementById('state');
    const fill = document.getElementById('fill');
    const percent = document.getElementById('percent');
    const speed = document.getElementById('speed');
    const ok = document.getElementById('ok');
    const err = document.getElementById('err');

    // API exposée par preload
    window.bento?.onUpdateEvent(({ type, progress, error }) => {
      switch (type) {
        case 'checking':
          state.textContent = 'Recherche de mise à jour…';
          break;
        case 'available':
          state.textContent = 'Mise à jour disponible. Téléchargement en cours…';
          break;
        case 'progress':
          const pct = Math.max(0, Math.min(100, progress.percent || 0));
          fill.style.width = pct.toFixed(1) + '%';
          percent.textContent = pct.toFixed(1) + '%';
          const mbps = (progress.bytesPerSecond || 0) / (1024 * 1024);
          speed.textContent = mbps.toFixed(2) + ' MB/s';
          break;
        case 'downloaded':
          state.textContent = 'Téléchargement terminé.';
          ok.style.display = 'block';
          percent.textContent = '100%';
          fill.style.width = '100%';
          speed.textContent = '…';
          break;
        case 'error':
          err.textContent = 'Erreur: ' + error;
          err.style.display = 'block';
          state.textContent = 'Échec de la mise à jour. Ouverture de l’application…';
          break;
        default:
          break;
      }
    });
  </script>
</body>
</html>